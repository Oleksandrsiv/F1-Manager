# Документація до реалізації F1 Manager

## 1. Короткий опис теми та призначення програми

Назва: F1 Manager
Це консольний застосунок для симуляції перегонів Формули 1. Користувач виступає у ролі стратега й віддає накази пілотам. Гравець змагається проти комп’ютера та має стежити за темпом пілота, рівнем пального, станом гуми, температурою й погодними умовами, які впливають на витрати ресурсів і швидкість.
На початку гри програма генерує випадковий трек і розраховує витрати ресурсів та час проходження кола для кожного боліда.
Після кожного кола гравець отримує інформацію про час проходження, відставання та інші характеристики боліда, щоб мати змогу коригувати стратегію.
Також гравець може приймати рішення про піт-стопи — для дозаправки або заміни шин.
Основна мета — надати просту, але гнучку стратегію для перегонів з урахуванням обмежень боліда.

---

## 2. Архітектура програми

### Основні компоненти та їх ролі
- **ConsoleApp/** — Точка входу, організовує ігровий цикл, взаємодіє з користувачем, ініціалізує всі компоненти.
- **Ui/** — Відповідає за інтерфейс користувача, меню, відображення статистики, результатів, вибір дій гравця (`RaceInterface`, `Arrows`).
- **Ai.Lib/** — Містить логіку штучного інтелекту для ботів (`AIController`).
- **ClassLibrary1/** — Основна бібліотека з моделями автомобіля (`CarF1`), треку (`Track`), погодних умов (`WeatherManager`), менеджменту перегонів (`RaceManager`, `CarRaceData`), інцидентів (`IncidentManager`).

### Структура класів та розміщення функціональності
- `Program` — керує ігровим циклом, створює всі об'єкти, ініціалізує гру.
- `RaceInterface` — організовує взаємодію з гравцем, викликає симуляцію кола, піт-стопи, статистику.
- `AIController` — приймає рішення для ботів (темп, піт-стоп, вибір шин).
- `CarF1` — модель боліда, містить логіку витрат, зносу, розрахунків часу кола.
- `Track` — модель траси, впливає на час кола.
- `WeatherManager` — генерує та оновлює погоду, впливає на стратегію.
- `RaceManager` — керує списком учасників, сортує результати.
- `CarRaceData` — зберігає дані про болід у гонці.
- `Arrows` — реалізує меню зі стрілками.
- `CarFactory` — створює ботів з випадковими характеристиками.

## 2.1 Залежності класів у ClassLibrary1 (Car.Lib)

- **ICarF1** — базовий інтерфейс для боліда. Його реалізує клас `CarF1`. Використовується у всіх класах, які працюють з болідом (наприклад, `CarRaceData`, `IncidentManager`).
- **CarF1** — основна модель боліда. Використовує:
    - `IWeatherManager` для врахування погодних умов у розрахунках витрат, зносу, швидкості.
    - Взаємодіє з `Track` (для розрахунку часу кола) та зберігається у `CarRaceData`.
- **IWeatherManager** — інтерфейс для роботи з погодою. Реалізується класом `WeatherManager`. Використовується у `CarF1`, `Track`, `LapSimulator`, `RaceSession`.
- **WeatherManager** — реалізує генерацію та оновлення погоди. Впливає на розрахунки у `CarF1`, ініціалізується у `Track` та використовується у симуляції гонки.
- **Track** — модель траси. Використовує `IWeatherManager` для ініціалізації погоди. Впливає на розрахунок ідеального часу кола для болідів.
- **IncidentManager** — статичний клас для визначення інцидентів. Використовує `ICarF1`, `Track`, `IWeatherManager` для оцінки ймовірності інциденту.
- **CarRaceData** — зберігає стан боліда у гонці. Містить посилання на `ICarF1`. Оновлює статистику, викликає `IncidentManager` для перевірки інцидентів.
- **RaceManager** — керує списком `CarRaceData`. Використовується для реєстрації, сортування та доступу до учасників гонки.
- **LapSimulator** — симулює проходження кола для боліда. Використовує `Track`, `IWeatherManager`, працює з `CarRaceData`.
- **RaceSession** — організовує повний процес гонки: створює трек, погоду, менеджер гонки, симулятор кіл. Реєструє боліди, симулює кола, повертає дані гонки.

### Схематично:
- `RaceSession` → `Track`, `WeatherManager`, `RaceManager`, `LapSimulator`
- `LapSimulator` → `Track`, `IWeatherManager`, `CarRaceData`
- `RaceManager` → список `CarRaceData` → містить `ICarF1` (реалізація — `CarF1`)
- `CarF1` → використовує `IWeatherManager` для розрахунків
- `IncidentManager` → працює з `ICarF1`, `Track`, `IWeatherManager`
- `CarRaceData` → містить `ICarF1`, викликає `IncidentManager`
- `Track` → використовує `IWeatherManager` для генерації погоди
- `WeatherManager` — самостійний

---

## 3. Обґрунтування технічних рішень

- **Інтерфейси (`ICarF1`, `IWeatherManager`, `IRaceInterface`)**: Забезпечують слабку зв'язність, спрощують тестування та розширення. Альтернатива — жорстка зв'язність через конкретні класи — ускладнила б підтримку.
- **Виділення AI в окремий клас (`AIController`)**: Дозволяє змінювати/розширювати логіку ботів незалежно від решти коду. Альтернатива — інтеграція AI у `CarF1` або `RaceSession` — призвела б до надмірної складності класів.
- **Меню зі стрілками (`Arrows`)**: Покращує UX у консолі. Альтернатива — простий ввід чисел — менш зручна для користувача.
- **Модульність**: Кожен компонент відповідає за свою частину логіки, що спрощує розширення (наприклад, додавання нових типів шин, погодних умов, стратегій AI).

---

## 4. Опис ключових алгоритмів та логіки

### 4.1 Симуляція кола (`RaceInterface.SimulateLap`)
1. Для кожного боліда розраховується ідеальний час кола (`Track.CalculateIdealTime`).
2. AI приймає рішення для ботів (темп, піт-стоп, шини).
3. Для кожного боліда:
   - Встановлюються множники (темп, шини, погода).
   - Викликається `Ride` (розрахунок витрат пального, зносу шин, можливий DNF).
   - Розраховується час кола (`CalculateLapTime`).
   - Оновлюється статистика (`UpdateList`).

### 4.2 Логіка AI (`AIController.AiMakeDecision`)
- Враховує залишок пального, знос шин, погодні умови, фінальні кола.
- Вибирає темп (агресивний/нормальний/економічний) залежно від стану боліда та погоди.
- Приймає рішення про піт-стоп, зміну шин, дозаправку.
- Вибирає оптимальний тип шин під погоду та дистанцію.

### 4.3 Розрахунок часу кола (`CarF1.CalculateLapTime`)
- Враховує ідеальний час, множники від темпу, типу шин, зносу, погоди.
- Додає штрафи за піт-стоп, інциденти, нестачу пального.

### 4.4 Витрати пального та знос шин (`CarF1.Ride`)
- Витрати залежать від темпу, типу шин, погоди.
- Знос шин прискорюється при неправильному типі шин для погоди.
- Якщо пального або шин недостатньо — болід вибуває (DNF).

### 4.5 Інциденти (`IncidentManager.CheckForIncident`)
- Випадковим чином визначає інциденти (з урахуванням погоди, темпу, зносу шин).
- При інциденті болід вибуває з гонки.
